<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free concrete slab ULS design calculator. Calculate moment resistance MRd for reinforced concrete slabs with step-by-step mathematical derivations.">
  <meta name="keywords" content="concrete slab design, ULS, moment resistance, MRd, structural engineering, reinforcement calculation">
  <title>Concrete Slab Design Calculator - Free Engineering Tool</title>
  
  <!-- Open Graph tags -->
  <meta property="og:title" content="Concrete Slab Design Calculator - Free Engineering Tool">
  <meta property="og:description" content="Calculate ULS moment resistance for concrete slabs with detailed mathematical steps">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://magnusfjeldolsen.github.io/structural_tools/concrete_slab_design">
  <meta property="og:image" content="https://magnusfjeldolsen.github.io/structural_tools/concrete_slab_design/calculations.png">
  
  <!-- Twitter Card tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Concrete Slab Design Calculator - Free Engineering Tool">
  <meta name="twitter:description" content="Calculate ULS moment resistance for concrete slabs with detailed mathematical steps">
  <meta name="twitter:image" content="https://magnusfjeldolsen.github.io/structural_tools/concrete_slab_design/calculations.png">
  
  <!-- Centralized CSS -->
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/forms.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/print.css">
  
  <!-- Tailwind CSS -->
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col items-center p-4">

  <main class="w-full max-w-6xl bg-gray-800 shadow-lg rounded-xl p-6 space-y-6 mt-8">
    <h2 class="text-2xl font-semibold text-center text-white">Concrete Slab ULS Design Calculator</h2>
    <p class="text-center text-gray-300 text-sm">Calculate Ultimate Limit State moment resistance (M<sub>Rd</sub>) for reinforced concrete slabs</p>

    <!-- Input Form -->
    <form id="calc-form" onsubmit="event.preventDefault(); calculateAndShow();" class="grid md:grid-cols-2 gap-6">
      
      <!-- Geometry Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-blue-400 mb-4">Geometry</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="MEd" class="text-sm font-medium min-w-[100px] text-right">M<sub>Ed</sub> (kNm):</label>
            <input type="text" id="MEd" value="20" placeholder="Example: 20*5^2/8" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="t" class="text-sm font-medium min-w-[100px] text-right">t (mm):</label>
            <input type="number" id="t" value="200" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="c" class="text-sm font-medium min-w-[100px] text-right">c (mm):</label>
            <input type="number" id="c" value="35" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Material Properties Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-yellow-400 mb-4">Material Properties</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="fcd" class="text-sm font-medium min-w-[100px] text-right">f<sub>cd</sub> (MPa):</label>
            <input type="number" id="fcd" value="19.8" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="fyd" class="text-sm font-medium min-w-[100px] text-right">f<sub>yd</sub> (MPa):</label>
            <input type="number" id="fyd" value="435" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Reinforcement Section -->
      <div class="bg-gray-700 rounded-lg p-6 md:col-span-2">
        <h3 class="text-xl font-semibold text-green-400 mb-4">Reinforcement</h3>
        
        <div class="grid md:grid-cols-2 gap-4">
          <div class="flex items-center gap-4">
            <label for="phi_l" class="text-sm font-medium min-w-[100px] text-right">φ<sub>l</sub> (mm):</label>
            <input type="number" id="phi_l" value="12" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="cc_l" class="text-sm font-medium min-w-[100px] text-right">cc<sub>l</sub> (mm):</label>
            <input type="number" id="cc_l" value="200" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

    </form>

    <!-- Calculate Button -->
    <div class="space-y-2 print:hidden">
      <button onclick="calculateAndShow()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition">
        Calculate M<sub>Rd</sub>
      </button>
    </div>

    <!-- Results Section -->
    <div id="results" style="display:none;" class="mt-8 border border-gray-600 rounded-lg p-6 bg-gray-700/50">
      <div id="calc-steps" class="text-white">
        <!-- Calculation boxes will be inserted here -->
      </div>

      <!-- Print Button at Bottom -->
      <div class="mt-8 print:hidden">
        <button id="print-btn" style="display:none;" onclick="window.print()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg transition">
          Print to PDF
        </button>
      </div>
    </div>

    <!-- Footer Info -->
    <div class="text-center text-sm text-gray-400 pt-6 border-t border-gray-600">
      <p>Free structural engineering calculator by <span class="text-blue-400 font-semibold">Magnus Fjeld Olsen</span></p>
      <p class="mt-1">Based on Eurocode 2 (EC2) standards</p>
    </div>
  </main>

  <script>
    function toFixedIfNeeded(num, digits=2) {
      return num.toFixed(digits);
    }


    // Safe mathematical expression evaluator
    function evaluateExpression(expr) {
      try {
        // Remove any characters that aren't numbers, operators, parentheses, or decimals
        const sanitized = expr.replace(/[^0-9+\-*/().\s^]/g, '');
        
        // Replace ^ with ** for JavaScript exponentiation
        const jsExpression = sanitized.replace(/\^/g, '**');
        
        // Use Function constructor for safer evaluation than eval()
        const result = new Function('return ' + jsExpression)();
        
        // Check if result is a valid number
        if (isNaN(result) || !isFinite(result)) {
          throw new Error('Invalid calculation result');
        }
        
        return result;
      } catch (error) {
        console.error('Expression evaluation error:', error);
        return NaN;
      }
    }

    function calculateAndShow() {
      // Get inputs with mathematical expression support for MEd
      const MEdInput = document.getElementById('MEd').value.trim();
      const MEd = isNaN(parseFloat(MEdInput)) ? evaluateExpression(MEdInput) : parseFloat(MEdInput);
      
      // Check if MEd evaluation was successful
      if (isNaN(MEd)) {
        alert('Invalid mathematical expression in MEd. Please check your input.');
        return;
      }
      
      const t = parseFloat(document.getElementById('t').value);
      const fcd = parseFloat(document.getElementById('fcd').value);
      const c = parseFloat(document.getElementById('c').value);
      const phi_l = parseFloat(document.getElementById('phi_l').value);
      const cc_l = parseFloat(document.getElementById('cc_l').value);
      const fyd = parseFloat(document.getElementById('fyd').value);

      // Step 1: d = t - c - phi_l/2
      const d = t - c - phi_l / 2;

      // Step 2: As = π * phi_l^2 / 4 * 1000 / cc_l
      const As = (Math.PI * Math.pow(phi_l, 2) / 4) * 1000 / cc_l;

      // Step 3: MRd,c = 0.275 * 1000 * d^2 * fcd  (Nm)
      const MRd_c_Nm = 0.275 * 1000 * d * d * fcd;

      // Step 4: z = min(0.95 * d, d * (1 - 0.17 * MEd / MRd_c))
      const z1 = 0.95 * d;
      const z2 = d * (1 - 0.17 * MEd * 1000 / MRd_c_Nm); // convert MEd to Nm for consistent units
      const z = Math.min(z1, z2);

      // Step 5: MRd,s = As * fyd * z (Nm)
      const MRd_s_Nm = As * fyd * z;

      // Step 6: MRd = min(MRd,c , MRd,s) (Nm)
      const MRd_Nm = Math.min(MRd_c_Nm, MRd_s_Nm);

      // Format moments in kNm (divide Nm by 1000000)
      const MRd_c = MRd_c_Nm / 1000000;
      const MRd_s = MRd_s_Nm / 1000000;
      const MRd = MRd_Nm / 1000000;

      // Create organized calculation boxes
      const stepsLatex = `
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-blue-400 mb-4">ULS Calculation Results</h2>
      </div>
      
      <!-- Geometry Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-blue-300">Geometry</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">M<sub>Ed</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(MEd)} kNm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">t</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(t)} mm</span>
            <span class="calc-label ml-6">c</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(c)} mm</span>
          </div>
          <div class="calc-separator"></div>
          <div class="calc-row">
            <span class="calc-label">d</span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">t - c - φ<sub>l</sub>/2 = ${toFixedIfNeeded(t)} - ${toFixedIfNeeded(c)} - ${toFixedIfNeeded(phi_l)}/2</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(d)} mm</span>
          </div>
        </div>
      </div>

      <!-- Reference Diagram -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-gray-300">Reference Diagram</h3>
        </div>
        <div class="calc-content">
          <div class="flex justify-start">
            <div class="bg-white p-4 rounded-lg">
              <img src="calculations.png" alt="Calculation symbols and figure" class="w-full h-auto rounded max-w-md" />
            </div>
          </div>
        </div>
      </div>

      <!-- Material Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-yellow-300">Material</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">f<sub>cd</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fcd)} MPa</span>
            <span class="calc-label ml-6">f<sub>yd</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fyd)} MPa</span>
          </div>
        </div>
      </div>

      <!-- Reinforcement Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-green-300">Reinforcement</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">φ<sub>l</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(phi_l)} mm</span>
            <span class="calc-label ml-6">cc<sub>l</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(cc_l)} mm</span>
          </div>
          <div class="calc-separator"></div>
          <div class="calc-row">
            <span class="calc-label">A<sub>s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">(π × φ<sub>l</sub>² / 4) × (1000 / cc<sub>l</sub>) = (π × ${toFixedIfNeeded(phi_l)}² / 4) × (1000 / ${toFixedIfNeeded(cc_l)})</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(As)} mm²</span>
          </div>
        </div>
      </div>

      <!-- ULS Capacities Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-red-300">ULS - Capacities</h3>
        </div>
        <div class="calc-content">
          <h4 class="text-md font-medium text-blue-200 mb-3 border-b border-gray-600 pb-1">Moment Capacity from Concrete</h4>
          <div class="calc-row">
            <span class="calc-label">M<sub>Rd,c</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">0.275 × 1000 × d² × f<sub>cd</sub> = 0.275 × 1000 × (${toFixedIfNeeded(d)})² × ${toFixedIfNeeded(fcd)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(MRd_c)} kNm</span>
          </div>
          
          <h4 class="text-md font-medium text-purple-200 mb-3 mt-6 border-b border-gray-600 pb-1">Lever Arm</h4>
          <div class="calc-row">
            <span class="calc-label">z</span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">min(0.95d, z<sub>bal</sub>) = min(${toFixedIfNeeded(z1)}, ${toFixedIfNeeded(z2)})</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(z)} mm</span>
          </div>
          
          <h4 class="text-md font-medium text-green-200 mb-3 mt-6 border-b border-gray-600 pb-1">Moment Capacity from Steel</h4>
          <div class="calc-row">
            <span class="calc-label">M<sub>Rd,s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">A<sub>s</sub> × f<sub>yd</sub> × z = ${toFixedIfNeeded(As)} × ${toFixedIfNeeded(fyd)} × ${toFixedIfNeeded(z)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(MRd_s)} kNm</span>
          </div>
          
          <div class="calc-separator mt-6"></div>
          <div class="calc-row">
            <span class="calc-label text-xl font-bold">M<sub>Rd</sub></span>
            <span class="calc-equals text-xl">=</span>
            <span class="calc-expression">min(M<sub>Rd,c</sub>, M<sub>Rd,s</sub>) = min(${toFixedIfNeeded(MRd_c)}, ${toFixedIfNeeded(MRd_s)})</span>
            <span class="calc-equals text-xl">=</span>
            <span class="calc-value text-xl font-bold text-green-400">${toFixedIfNeeded(MRd)} kNm</span>
          </div>
        </div>
      </div>
      
      <div class="mt-8 p-6 bg-gray-800 rounded-lg border-l-4 border-blue-500">
        <h3 class="text-xl font-bold text-white mb-4">Summary of Results</h3>
        <div class="grid md:grid-cols-2 gap-6 text-sm">
          <div>
            <h4 class="font-semibold text-blue-400 mb-2">Capacity Check</h4>
            <p><span class="text-gray-300">M<sub>Rd,c</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MRd_c)} kNm</span></p>
            <p><span class="text-gray-300">M<sub>Rd,s</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MRd_s)} kNm</span></p>
            <p><span class="text-gray-300">M<sub>Rd</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MRd)} kNm</span></p>
          </div>
          <div>
            <h4 class="font-semibold text-green-400 mb-2">Utilization</h4>
            <p><span class="text-gray-300">M<sub>Ed</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MEd)} kNm</span></p>
            <p class="mt-2"><span class="text-gray-300">Utilization:</span> <span class="font-mono ${MEd/MRd > 1 ? 'text-red-400' : MEd/MRd > 0.85 ? 'text-yellow-400' : 'text-green-400'}">${toFixedIfNeeded(MEd/MRd*100, 1)}%</span></p>
            <p class="text-sm mt-1 ${MEd/MRd > 1 ? 'text-red-400' : MEd/MRd > 0.85 ? 'text-yellow-400' : 'text-green-400'}">
              ${MEd/MRd > 1 ? 'FAILED - Increase reinforcement' : MEd/MRd > 0.85 ? 'High utilization' : 'OK'}
            </p>
          </div>
        </div>
      </div>
      `;

      const container = document.getElementById('calc-steps');
      container.innerHTML = stepsLatex;
      document.getElementById('results').style.display = 'block';
      document.getElementById('print-btn').style.display = 'block';

      // Scroll to results
      document.getElementById('results').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  </script>

  <!-- Centralized JavaScript -->
  <script src="../assets/js/common.js"></script>
  
</body>
</html>