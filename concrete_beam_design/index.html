<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free concrete beam ULS design calculator. Calculate moment and shear capacity with detailed step-by-step derivations.">
  <meta name="keywords" content="concrete beam design, ULS, moment capacity, shear capacity, structural engineering">
  <title>Concrete Beam Calculator - ULS Design Tool</title>
  
  <!-- Open Graph tags -->
  <meta property="og:title" content="Concrete Beam Calculator - ULS Design Tool">
  <meta property="og:description" content="Calculate moment and shear capacity of concrete beams with detailed mathematical derivations">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://magnusfjeldolsen.github.io/structural_tools/concrete_beam_design">
  
  <!-- Centralized CSS -->
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/forms.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/print.css">
  
  <!-- Tailwind CSS -->
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="concrete_beam_api.js"></script>

</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col items-center p-4">


  <main class="w-full max-w-6xl bg-gray-800 shadow-lg rounded-xl p-6 space-y-6 mt-8">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-white mb-2">Concrete Beam ULS Design Calculator</h1>
      <p class="text-gray-300">Calculate moment and shear capacity with detailed step-by-step derivations</p>
    </div>

    <!-- Input Form -->
    <form id="calc-form" onsubmit="event.preventDefault(); calculateAndShow();" class="grid md:grid-cols-2 gap-6">
      
      <!-- Geometry Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-blue-400 mb-4">Geometry</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="b" class="text-sm font-medium min-w-[100px] text-right">b (mm):</label>
            <input type="number" id="b" value="250" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="h" class="text-sm font-medium min-w-[100px] text-right">h (mm):</label>
            <input type="number" id="h" value="500" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="c" class="text-sm font-medium min-w-[100px] text-right">c (mm):</label>
            <input type="number" id="c" value="25" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Loads Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-red-400 mb-4">Applied Loads</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="MEd" class="text-sm font-medium min-w-[100px] text-right">M<sub>Ed</sub> (kNm):</label>
            <input type="text" id="MEd" value="39" placeholder="Example input: 20*5^2/8" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="VEd" class="text-sm font-medium min-w-[100px] text-right">V<sub>Ed</sub> (kN):</label>
            <input type="text" id="VEd" value="260" placeholder="Example input: 20*5/2" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Longitudinal Reinforcement Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-green-400 mb-4">Longitudinal Reinforcement</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="phi_l" class="text-sm font-medium min-w-[100px] text-right">œÜ<sub>l</sub> (mm):</label>
            <input type="number" id="phi_l" value="20" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="n_l" class="text-sm font-medium min-w-[100px] text-right">n<sub>l</sub>:</label>
            <input type="number" id="n_l" value="2" step="1" min="1" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Shear Reinforcement Section -->
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold text-purple-400 mb-4">Shear Reinforcement</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label for="phi_b" class="text-sm font-medium min-w-[100px] text-right">œÜ<sub>b</sub> (mm):</label>
            <input type="number" id="phi_b" value="12" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="cc_b" class="text-sm font-medium min-w-[100px] text-right">cc<sub>b</sub> (mm):</label>
            <input type="number" id="cc_b" value="185" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="n_snitt" class="text-sm font-medium min-w-[100px] text-right">n<sub>snitt</sub>:</label>
            <input type="number" id="n_snitt" value="2" step="1" min="1" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

      <!-- Material Properties Section -->
      <div class="bg-gray-700 rounded-lg p-6 md:col-span-2">
        <h3 class="text-xl font-semibold text-yellow-400 mb-4">Material Properties</h3>
        
        <div class="grid md:grid-cols-2 gap-4">
          <div class="flex items-center gap-4">
            <label for="fck" class="text-sm font-medium min-w-[100px] text-right">f<sub>ck</sub> (MPa):</label>
            <input type="number" id="fck" value="35" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="fyk" class="text-sm font-medium min-w-[100px] text-right">f<sub>yk</sub> (MPa):</label>
            <input type="number" id="fyk" value="500" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="alpha_cc" class="text-sm font-medium min-w-[100px] text-right">Œ±<sub>cc</sub>:</label>
            <input type="number" id="alpha_cc" value="0.85" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="gamma_s" class="text-sm font-medium min-w-[100px] text-right">Œ≥<sub>s</sub>:</label>
            <input type="number" id="gamma_s" value="1.25" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
          
          <div class="flex items-center gap-4">
            <label for="gamma_c" class="text-sm font-medium min-w-[100px] text-right">Œ≥<sub>c</sub>:</label>
            <input type="number" id="gamma_c" value="1.5" step="any" required class="flex-1 px-3 py-2 bg-gray-600 text-white border border-gray-500 rounded-md focus:outline-none focus:ring focus:ring-blue-400">
          </div>
        </div>
      </div>

    </form>

    <!-- Calculate Button -->
    <div class="space-y-2 print:hidden">
      <button onclick="calculateAndShow()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition">
        Calculate ULS Capacities
      </button>
    </div>

    <!-- Results -->
    <div id="results" class="mt-8 border border-gray-600 rounded-lg p-6 bg-gray-700/50 hidden">
      <div id="calc-steps" class="text-white"></div>
      
      <!-- Print Button at Bottom -->
      <div class="mt-8 print:hidden">
        <button onclick="window.print()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg transition">
          Print to PDF
        </button>
      </div>
    </div>

    <!-- API Integration Section -->
    <div class="mt-8 border border-gray-600 rounded-lg p-6 bg-gray-700/50">
      <h2 class="text-2xl font-semibold text-purple-400 mb-6">API Integration</h2>
      <p class="text-gray-300 mb-6">
        Use this concrete beam calculator programmatically from Python scripts. The page exposes a JavaScript API that can process single calculations or batches of calculations.
      </p>

      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-gray-800 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-green-400 mb-4">üìã Input JSON Format</h3>
          <div class="bg-gray-900 rounded p-4 text-sm font-mono text-green-300 overflow-x-auto">
            <pre id="beam-input-json-example">{
  "geometry": {
    "b": 250,
    "h": 500,
    "c": 25
  },
  "loads": {
    "MEd": "39",
    "VEd": "260"
  },
  "longitudinal_reinforcement": {
    "phi_l": 20,
    "n_l": 2
  },
  "shear_reinforcement": {
    "phi_b": 12,
    "cc_b": 185,
    "n_snitt": 2
  },
  "material": {
    "fck": 35,
    "fyk": 500,
    "alpha_cc": 0.85,
    "gamma_c": 1.5,
    "gamma_s": 1.25
  }
}</pre>
          </div>
          <button class="mt-2 px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded" onclick="copyToClipboard('beam-input-json-example')">
            Copy JSON
          </button>
        </div>

        <div class="bg-gray-800 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-blue-400 mb-4">üìä Output JSON Structure</h3>
          <div class="bg-gray-900 rounded p-4 text-sm font-mono text-blue-300 overflow-x-auto">
            <pre>{
  "success": true,
  "input": {...},
  "results": {
    "moment_capacity": {
      "MRd_c": 46.67,
      "MRd_s": 75.24,
      "MRd": 46.67
    },
    "shear_capacity": {
      "VRd_s": 261.36
    },
    "status": {
      "overall": "OK",
      "utilizations": {
        "moment": 83.6,
        "shear": 99.5,
        "tensile": 89.2
      }
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z"
}</pre>
          </div>
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 mt-6">
        <h3 class="text-lg font-semibold text-yellow-400 mb-4">üêç Python Integration Example</h3>
        <div class="bg-gray-900 rounded p-4 text-sm font-mono text-yellow-300 overflow-x-auto">
          <pre id="beam-python-example">#!/usr/bin/env python3
"""
Concrete Beam Calculator API Integration
Automates ULS beam design calculations
"""

import json
import pandas as pd
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class ConcreteBeamCalculator:
    def __init__(self, headless=True):
        self.options = Options()
        if headless:
            self.options.add_argument('--headless')
        self.options.add_argument('--no-sandbox')
        self.options.add_argument('--disable-dev-shm-usage')
        self.driver = None
        
    def __enter__(self):
        self.driver = webdriver.Chrome(options=self.options)
        self.driver.get("https://yoursite.com/structural_tools/concrete_beam_design/")
        
        WebDriverWait(self.driver, 10).until(
            EC.presence_of_element_located((By.ID, "calc-form"))
        )
        return self
        
    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.driver:
            self.driver.quit()
    
    def calculate_single(self, params):
        result = self.driver.execute_script(
            "return window.concreteBeamCalculate(arguments[0]);", 
            params
        )
        return result
    
    def calculate_batch(self, params_list):
        result = self.driver.execute_script(
            "return window.concreteBeamCalculate(arguments[0]);", 
            params_list
        )
        return result

# Example usage
base_params = {
    "geometry": {"b": 250, "h": 500, "c": 25},
    "loads": {"MEd": "39", "VEd": "260"},
    "longitudinal_reinforcement": {"phi_l": 20, "n_l": 2},
    "shear_reinforcement": {"phi_b": 12, "cc_b": 185, "n_snitt": 2},
    "material": {"fck": 35, "fyk": 500, "alpha_cc": 0.85, "gamma_c": 1.5, "gamma_s": 1.25}
}

with ConcreteBeamCalculator(headless=True) as calc:
    result = calc.calculate_single(base_params)
    if result['success']:
        print(f"Moment Capacity: {result['results']['results']['moment_capacity']['MRd']} kNm")
        print(f"Shear Capacity: {result['results']['results']['shear_capacity']['VRd_s']} kN")
    
    # Parametric study - vary beam width
    batch_data = []
    for b in range(200, 401, 50):
        params = base_params.copy()
        params["geometry"] = {**params["geometry"], "b": b}
        batch_data.append(params)
    
    batch_result = calc.calculate_batch(batch_data)
    print(f"Batch processed: {batch_result['successful']}/{batch_result['batch_size']} calculations")
</pre>
        </div>
        <button class="mt-2 px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded" onclick="copyToClipboard('beam-python-example')">
          Copy Python Code
        </button>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 mt-6">
        <h3 class="text-lg font-semibold text-indigo-400 mb-4">üß™ Test API Live</h3>
        <p class="text-gray-300 text-sm mb-4">
          Click the button below to test the API functionality in your browser console (F12 ‚Üí Console).
        </p>
        <button onclick="window.ConcreteBeamAPI.testAPI()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition">
          üß™ Run API Tests
        </button>
        <div class="mt-2 text-xs text-gray-400">
          Open browser console (F12) to see test results
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 mt-6">
        <h3 class="text-lg font-semibold text-cyan-400 mb-4">üöÄ Advanced Usage Tips</h3>
        <ul class="text-gray-300 space-y-2 text-sm">
          <li><strong>Expression Evaluation:</strong> MEd and VEd accept mathematical expressions like "20*5^2/8"</li>
          <li><strong>Batch Processing:</strong> Send arrays of parameter objects for parametric studies</li>
          <li><strong>Error Handling:</strong> Each result includes success flags and detailed error messages</li>
          <li><strong>Utilization Analysis:</strong> Get moment, shear, and tensile force utilization percentages</li>
          <li><strong>Status Checking:</strong> Results include overall status (OK, HIGH_UTILIZATION, FAILED)</li>
          <li><strong>Comprehensive Results:</strong> Access raw calculations, intermediate values, and final results</li>
        </ul>
      </div>
    </div>

  </main>

  <script>

    function toFixedIfNeeded(num, digits=2) {
      return num.toFixed(digits);
    }

    // Utility function to copy text to clipboard
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent || element.innerText;
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function() {
          // Show temporary feedback
          const button = event.target;
          const originalText = button.textContent;
          button.textContent = 'Copied!';
          button.style.backgroundColor = '#10b981';
          
          setTimeout(function() {
            button.textContent = originalText;
            button.style.backgroundColor = '';
          }, 2000);
        }).catch(function(err) {
          console.error('Failed to copy text: ', err);
          fallbackCopyTextToClipboard(text);
        });
      } else {
        fallbackCopyTextToClipboard(text);
      }
    }

    // Fallback copy function for older browsers
    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.top = "-999px";
      textArea.style.left = "-999px";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        const msg = successful ? 'successful' : 'unsuccessful';
        console.log('Fallback: Copying text command was ' + msg);
      } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
      }
      
      document.body.removeChild(textArea);
    }

    function calculateAndShow() {
      // Collect inputs in API format
      const inputs = {
        geometry: {
          b: parseFloat(document.getElementById('b').value),
          h: parseFloat(document.getElementById('h').value),
          c: parseFloat(document.getElementById('c').value)
        },
        loads: {
          MEd: document.getElementById('MEd').value.trim(),
          VEd: document.getElementById('VEd').value.trim()
        },
        longitudinal_reinforcement: {
          phi_l: parseFloat(document.getElementById('phi_l').value),
          n_l: parseFloat(document.getElementById('n_l').value)
        },
        shear_reinforcement: {
          phi_b: parseFloat(document.getElementById('phi_b').value),
          cc_b: parseFloat(document.getElementById('cc_b').value),
          n_snitt: parseFloat(document.getElementById('n_snitt').value)
        },
        material: {
          fck: parseFloat(document.getElementById('fck').value),
          fyk: parseFloat(document.getElementById('fyk').value),
          alpha_cc: parseFloat(document.getElementById('alpha_cc').value),
          gamma_c: parseFloat(document.getElementById('gamma_c').value),
          gamma_s: parseFloat(document.getElementById('gamma_s').value)
        }
      };

      // Use the API function
      const result = window.ConcreteBeamAPI.calculateConcreteBeam(inputs);
      
      if (!result.success) {
        alert('Calculation failed: ' + (result.errors ? result.errors.join('\n') : result.message));
        return;
      }

      // Extract values from API result
      const b = result.inputs.geometry.b;
      const h = result.inputs.geometry.h;
    const c = result.inputs.geometry.c;
      const MEd = result.inputs.loads.MEd;
      const VEd = result.inputs.loads.VEd;
      const phi_l = result.inputs.longitudinal_reinforcement.phi_l;
      const n_l = result.inputs.longitudinal_reinforcement.n_l;
      const phi_b = result.inputs.shear_reinforcement.phi_b;
      const cc_b = result.inputs.shear_reinforcement.cc_b;
      const n_snitt = result.inputs.shear_reinforcement.n_snitt;
      const fck = result.inputs.material.fck;
      const fyk = result.inputs.material.fyk;
      const alpha_cc = result.inputs.material.alpha_cc;
      const gamma_c = result.inputs.material.gamma_c;
      const gamma_s = result.inputs.material.gamma_s;

      const fcd = result.intermediate_calculations.material.fcd;
      const fyd = result.intermediate_calculations.material.fyd;
      const d = result.intermediate_calculations.geometry.d;
      const Asl = result.intermediate_calculations.geometry.Asl;
      const z = result.intermediate_calculations.geometry.z;
      const z_95d = result.intermediate_calculations.geometry.z_95d;
      const z_bal = result.intermediate_calculations.geometry.z_bal;

      const Asw = result.intermediate_calculations.shear.Asw;
      const z_skjaer = result.intermediate_calculations.shear.z_v;
      const cot_theta_initial = result.intermediate_calculations.shear.cot_theta_initial;
      const theta_initial = result.intermediate_calculations.shear.theta_initial;
      const cot_theta_red = result.intermediate_calculations.shear.cot_theta_red;
      const theta_red = result.intermediate_calculations.shear.theta_red;
      const cot_theta_final = result.intermediate_calculations.shear.cot_theta_final;
      const theta_final = result.intermediate_calculations.shear.theta_final;
      const angle_status = result.intermediate_calculations.shear.angle_status;

      const MRd_c = result.results.moment_capacity.MRd_c;
      const MRd_s = result.results.moment_capacity.MRd_s;
      const VRd_s_initial = result.results.shear_capacity.VRd_s_initial;
      const VRd_s_final = result.results.shear_capacity.VRd_s;
      const DeltaF_td = result.results.tensile_force.DeltaF_td;
      const F_tM = result.results.tensile_force.F_tM;
      const F_Ed = result.results.tensile_force.F_Ed;
      const F_Rd = result.results.tensile_force.F_Rd;

      // Create organized calculation boxes
      const stepsLatex = `
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-blue-400 mb-4">ULS Calculation Results</h2>
      </div>
      
      <!-- Geometry Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-blue-300">Geometry</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">b</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(b)} mm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">h</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(h)} mm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">c</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(c)} mm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">d</span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">h - c - œÜ<sub>l</sub>/2 = ${toFixedIfNeeded(h)} - ${toFixedIfNeeded(c)} - ${toFixedIfNeeded(phi_l)}/2</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(d)} mm</span>
          </div>
        </div>
      </div>

      <!-- Material Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-yellow-300">Material</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">f<sub>ck</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fck)} MPa</span>
            <span class="calc-label ml-6">Œ±<sub>cc</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(alpha_cc)}</span>
            <span class="calc-label ml-6">Œ≥<sub>c</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(gamma_c)}</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">f<sub>yk</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fyk)} MPa</span>
            <span class="calc-label ml-6">Œ≥<sub>s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(gamma_s)}</span>
          </div>
          <div class="calc-separator"></div>
          <div class="calc-row">
            <span class="calc-label">f<sub>cd</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">Œ±<sub>cc</sub> √ó f<sub>ck</sub> / Œ≥<sub>c</sub> = ${toFixedIfNeeded(alpha_cc)} √ó ${toFixedIfNeeded(fck)} / ${toFixedIfNeeded(gamma_c)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fcd)} MPa</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">f<sub>yd</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">f<sub>yk</sub> / Œ≥<sub>s</sub> = ${toFixedIfNeeded(fyk)} / ${toFixedIfNeeded(gamma_s)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(fyd)} MPa</span>
          </div>
        </div>
      </div>

      <!-- Longitudinal Reinforcement Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-green-300">Longitudinal Reinforcement</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">œÜ<sub>l</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(phi_l)} mm</span>
            <span class="calc-label ml-6">n<sub>l</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${n_l}</span>
          </div>
          <div class="calc-separator"></div>
          <div class="calc-row">
            <span class="calc-label">A<sub>sl</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">n<sub>l</sub> √ó œÄ √ó œÜ<sub>l</sub>¬≤ / 4 = ${n_l} √ó œÄ √ó (${toFixedIfNeeded(phi_l)})¬≤ / 4</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(Asl)} mm¬≤</span>
          </div>
        </div>
      </div>

      <!-- Stirrups Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-purple-300">Stirrups</h3>
        </div>
        <div class="calc-content">
          <div class="calc-row">
            <span class="calc-label">œÜ<sub>b</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(phi_b)} mm</span>
            <span class="calc-label ml-6">cc<sub>b</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(cc_b)} mm</span>
            <span class="calc-label ml-6">n<sub>snitt</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${n_snitt}</span>
          </div>
          <div class="calc-separator"></div>
          <div class="calc-row">
            <span class="calc-label">A<sub>sw</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">n<sub>snitt</sub> √ó œÄ √ó œÜ<sub>b</sub>¬≤ / 4 = ${n_snitt} √ó œÄ √ó (${toFixedIfNeeded(phi_b)})¬≤ / 4</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(Asw)} mm¬≤</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">z<sub>v</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">0.9 √ó d = 0.9 √ó ${toFixedIfNeeded(d)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(z_skjaer)} mm</span>
          </div>
        </div>
      </div>

      <!-- ULS Capacities Box -->
      <div class="calc-box mb-6">
        <div class="calc-header">
          <h3 class="text-lg font-semibold text-red-300">ULS - Capacities</h3>
        </div>
        <div class="calc-content">
          <h4 class="text-md font-medium text-blue-200 mb-3 border-b border-gray-600 pb-1">Moment Capacity</h4>
          <div class="calc-row">
            <span class="calc-label">M<sub>Rd,c</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">0.275 √ó b √ó d¬≤ √ó f<sub>cd</sub> = 0.275 √ó ${toFixedIfNeeded(b)} √ó (${toFixedIfNeeded(d)})¬≤ √ó ${toFixedIfNeeded(fcd)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(MRd_c)} kNm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">z</span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">min(0.95d, z<sub>bal</sub>) = min(${toFixedIfNeeded(z_95d)}, ${toFixedIfNeeded(z_bal)})</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(z)} mm</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">M<sub>Rd,s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">A<sub>sl</sub> √ó f<sub>yd</sub> √ó z = ${toFixedIfNeeded(Asl)} √ó ${toFixedIfNeeded(fyd)} √ó ${toFixedIfNeeded(z)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(MRd_s)} kNm</span>
          </div>
          
          <h4 class="text-md font-medium text-purple-200 mb-3 mt-6 border-b border-gray-600 pb-1">Shear Capacity</h4>
          <div class="calc-row">
            <span class="calc-label">V<sub>Ed</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(VEd)} kN</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">cot Œ∏</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(cot_theta_initial)}</span>
            <span class="calc-label ml-6">Œ∏</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(theta_initial)}¬∞</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">V<sub>Rd,s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">(A<sub>sw</sub> / cc<sub>b</sub>) √ó z<sub>v</sub> √ó f<sub>yd</sub> √ó cot Œ∏ = (${toFixedIfNeeded(Asw)} / ${toFixedIfNeeded(cc_b)}) √ó ${toFixedIfNeeded(z_skjaer)} √ó ${toFixedIfNeeded(fyd)} √ó ${toFixedIfNeeded(cot_theta_initial)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(VRd_s_initial)} kN</span>
          </div>
          
          <div class="calc-separator mt-4"></div>
          <div class="calc-row">
            <span class="calc-label">cot Œ∏<sub>red</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">V<sub>Ed</sub> / (A<sub>sw</sub>/cc<sub>b</sub> √ó z<sub>v</sub> √ó f<sub>yd</sub>) = ${toFixedIfNeeded(VEd)} / (${toFixedIfNeeded(Asw/cc_b)} √ó ${toFixedIfNeeded(z_skjaer)} √ó ${toFixedIfNeeded(fyd)})</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(cot_theta_red)}</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">Œ∏<sub>red</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(theta_red)}¬∞</span>
            <span class="calc-note ml-4 text-sm text-gray-400">reduced angle</span>
          </div>
          <div class="calc-row">
            <span class="calc-note text-sm">Limits: 1.0 ‚â§ cot Œ∏ ‚â§ 2.5</span>
          </div>
          <div class="calc-row">
            <span class="calc-note text-sm">Status: <strong class="${angle_status === 'OK' ? 'text-green-400' : 'text-orange-400'}">${angle_status}</strong></span>
          </div>
          <div class="calc-row">
            <span class="calc-label">Œ∏<sub>final</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(theta_final)}¬∞</span>
            <span class="calc-label ml-6">cot Œ∏<sub>final</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(cot_theta_final)}</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">V<sub>Rd,s</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">(A<sub>sw</sub> / cc<sub>b</sub>) √ó z<sub>v</sub> √ó f<sub>yd</sub> √ó cot Œ∏<sub>final</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(VRd_s_final)} kN</span>
          </div>
          
          <h4 class="text-md font-medium text-orange-200 mb-3 mt-6 border-b border-gray-600 pb-1">Additional Tensile Force</h4>
          <div class="calc-row">
            <span class="calc-label">ŒîF<sub>td</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">0.5 √ó V<sub>Ed</sub> √ó cot Œ∏<sub>final</sub> = 0.5 √ó ${toFixedIfNeeded(VEd)} √ó ${toFixedIfNeeded(cot_theta_final)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(DeltaF_td)} kN</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">F<sub>tM</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">M<sub>Ed</sub> / z = ${toFixedIfNeeded(MEd)} √ó 1000 / ${toFixedIfNeeded(z)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(F_tM)} kN</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">F<sub>Ed</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">F<sub>tM</sub> + ŒîF<sub>td</sub> = ${toFixedIfNeeded(F_tM)} + ${toFixedIfNeeded(DeltaF_td)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(F_Ed)} kN</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">F<sub>Rd</sub></span>
            <span class="calc-equals">=</span>
            <span class="calc-expression">A<sub>sl</sub> √ó f<sub>yd</sub> = ${toFixedIfNeeded(Asl)} √ó ${toFixedIfNeeded(fyd)}</span>
            <span class="calc-equals">=</span>
            <span class="calc-value">${toFixedIfNeeded(F_Rd)} kN</span>
          </div>
        </div>
      </div>
      
      <div class="mt-8 p-6 bg-gray-800 rounded-lg border-l-4 border-blue-500">
        <h3 class="text-xl font-bold text-white mb-4">Summary of Results</h3>
        <div class="grid md:grid-cols-2 gap-6 text-sm">
          <div>
            <h4 class="font-semibold text-blue-400 mb-2">Moment Capacity</h4>
            <p><span class="text-gray-300">M<sub>Rd,c</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MRd_c)} kNm</span></p>
            <p><span class="text-gray-300">M<sub>Rd,s</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MRd_s)} kNm</span></p>
            <p><span class="text-gray-300">M<sub>Ed</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(MEd)} kNm</span></p>
            <p class="mt-2"><span class="text-gray-300">Utilization:</span> <span class="font-mono ${result.status.utilizations.moment > 100 ? 'text-red-400' : result.status.utilizations.moment > 85 ? 'text-yellow-400' : 'text-green-400'}">${result.status.utilizations.moment}%</span></p>
          </div>
          <div>
            <h4 class="font-semibold text-purple-400 mb-2">Shear Capacity</h4>
            <p><span class="text-gray-300">V<sub>Rd,s</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(VRd_s_final)} kN</span></p>
            <p><span class="text-gray-300">V<sub>Ed</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(VEd)} kN</span></p>
            <p><span class="text-gray-300">Œ∏<sub>final</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(theta_final)}¬∞</span></p>
            <p class="mt-2"><span class="text-gray-300">Utilization:</span> <span class="font-mono ${result.status.utilizations.shear > 100 ? 'text-red-400' : result.status.utilizations.shear > 85 ? 'text-yellow-400' : 'text-green-400'}">${result.status.utilizations.shear}%</span></p>
          </div>
          <div>
            <h4 class="font-semibold text-green-400 mb-2">Tensile Force Check</h4>
            <p><span class="text-gray-300">F<sub>Ed</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(F_Ed)} kN</span></p>
            <p><span class="text-gray-300">F<sub>Rd</sub> =</span> <span class="font-mono text-white">${toFixedIfNeeded(F_Rd)} kN</span></p>
            <p class="mt-2"><span class="text-gray-300">Utilization:</span> <span class="font-mono ${result.status.utilizations.tensile > 100 ? 'text-red-400' : result.status.utilizations.tensile > 85 ? 'text-yellow-400' : 'text-green-400'}">${result.status.utilizations.tensile}%</span></p>
          </div>
        </div>
      </div>
      `;

      const container = document.getElementById('calc-steps');
      container.innerHTML = stepsLatex;
      document.getElementById('results').style.display = 'block';

      // Typeset math with MathJax
      MathJax.typesetPromise();
    }
  </script>

  <!-- Centralized JavaScript -->
  <script src="../assets/js/common.js"></script>

</body>
</html>